{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/amy%20gee/Desktop/Clinic_Management_System/backend/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  })\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n\r\nexport default prisma\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/amy%20gee/Desktop/Clinic_Management_System/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport prisma from '@/lib/db'\r\nimport bcrypt from 'bcryptjs'\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    let body: unknown\r\n\r\n    try {\r\n      body = await request.json()\r\n    } catch (parseError) {\r\n      console.error('JSON parse error:', parseError)\r\n      return new Response(JSON.stringify({ error: 'Invalid JSON in request body' }), {\r\n        status: 400,\r\n        headers: { 'Content-Type': 'application/json' }\r\n      })\r\n    }\r\n\r\n    const { usernameOrEmail, password } = body as { usernameOrEmail?: unknown; password?: unknown }\r\n\r\n    // Validation\r\n    if (!usernameOrEmail || !password) {\r\n      return new Response(JSON.stringify({ error: 'Username/email and password are required' }), {\r\n        status: 400,\r\n        headers: { 'Content-Type': 'application/json' }\r\n      })\r\n    }\r\n\r\n    // Find user by username or email\r\n    let user\r\n    try {\r\n      user = await prisma.user.findFirst({\r\n        where: {\r\n          OR: [\r\n            { username: String(usernameOrEmail) },\r\n            { email: String(usernameOrEmail) }\r\n          ]\r\n        }\r\n      })\r\n    } catch (dbError) {\r\n      console.error('Database error:', dbError)\r\n      return new Response(JSON.stringify({ error: 'Database connection error' }), {\r\n        status: 500,\r\n        headers: { 'Content-Type': 'application/json' }\r\n      })\r\n    }\r\n\r\n    if (!user) {\r\n      return new Response(JSON.stringify({ error: 'Invalid username/email or password' }), {\r\n        status: 401,\r\n        headers: { 'Content-Type': 'application/json' }\r\n      })\r\n    }\r\n\r\n    // Check password\r\n    let passwordMatch = false\r\n    try {\r\n      passwordMatch = await bcrypt.compare(String(password), user.password)\r\n    } catch (bcryptError) {\r\n      console.error('Bcrypt error:', bcryptError)\r\n      return new Response(JSON.stringify({ error: 'Password verification failed' }), {\r\n        status: 500,\r\n        headers: { 'Content-Type': 'application/json' }\r\n      })\r\n    }\r\n\r\n    if (!passwordMatch) {\r\n      return new Response(JSON.stringify({ error: 'Invalid username/email or password' }), {\r\n        status: 401,\r\n        headers: { 'Content-Type': 'application/json' }\r\n      })\r\n    }\r\n\r\n    // Return user data (without password)\r\n    const { password: _, ...userWithoutPassword } = user\r\n    return new Response(JSON.stringify({ user: userWithoutPassword }), {\r\n      status: 200,\r\n      headers: { 'Content-Type': 'application/json' }\r\n    })\r\n  } catch (error) {\r\n    console.error('Login error:', error)\r\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error'\r\n    return new Response(JSON.stringify({ error: `Internal server error: ${errorMessage}` }), {\r\n      status: 500,\r\n      headers: { 'Content-Type': 'application/json' }\r\n    })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,IAAI;QAEJ,IAAI;YACF,OAAO,MAAM,QAAQ,IAAI;QAC3B,EAAE,OAAO,YAAY;YACnB,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA+B,IAAI;gBAC7E,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,MAAM,EAAE,eAAe,EAAE,QAAQ,EAAE,GAAG;QAEtC,aAAa;QACb,IAAI,CAAC,mBAAmB,CAAC,UAAU;YACjC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA2C,IAAI;gBACzF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,iCAAiC;QACjC,IAAI;QACJ,IAAI;YACF,OAAO,MAAM,iIAAM,CAAC,IAAI,CAAC,SAAS,CAAC;gBACjC,OAAO;oBACL,IAAI;wBACF;4BAAE,UAAU,OAAO;wBAAiB;wBACpC;4BAAE,OAAO,OAAO;wBAAiB;qBAClC;gBACH;YACF;QACF,EAAE,OAAO,SAAS;YAChB,QAAQ,KAAK,CAAC,mBAAmB;YACjC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA4B,IAAI;gBAC1E,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAqC,IAAI;gBACnF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,iBAAiB;QACjB,IAAI,gBAAgB;QACpB,IAAI;YACF,gBAAgB,MAAM,8IAAM,CAAC,OAAO,CAAC,OAAO,WAAW,KAAK,QAAQ;QACtE,EAAE,OAAO,aAAa;YACpB,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA+B,IAAI;gBAC7E,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,IAAI,CAAC,eAAe;YAClB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAqC,IAAI;gBACnF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,sCAAsC;QACtC,MAAM,EAAE,UAAU,CAAC,EAAE,GAAG,qBAAqB,GAAG;QAChD,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,MAAM;QAAoB,IAAI;YACjE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO,CAAC,uBAAuB,EAAE,cAAc;QAAC,IAAI;YACvF,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF"}}]
}