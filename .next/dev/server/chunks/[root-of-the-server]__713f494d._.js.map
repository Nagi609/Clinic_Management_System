{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/marienel/Downloads/clinic-management-system/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  })\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n\r\nexport default prisma\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/marienel/Downloads/clinic-management-system/app/api/visits/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport prisma from '@/lib/db'\r\n\r\n// Utility: return JSON with status\r\nfunction json(data: any, status = 200) {\r\n  return NextResponse.json(data, { status })\r\n}\r\n\r\n// ─────────────────────────────────────────────\r\n// GET - All visit records for current user\r\n// ─────────────────────────────────────────────\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const userId = request.headers.get('x-user-id')\r\n    if (!userId) return json({ error: 'Unauthorized' }, 401)\r\n\r\n    const visits = await prisma.visitRecord.findMany({\r\n      where: { userId },\r\n      include: {\r\n        Patient: {\r\n          select: {\r\n            id: true,\r\n            firstName: true,\r\n            middleName: true,\r\n            lastName: true,\r\n            suffix: true,\r\n            gender: true,\r\n            idNumber: true,\r\n            program: true,\r\n            course: true,\r\n            yearLevel: true\r\n          }\r\n        },\r\n        User: {\r\n          select: { fullName: true }\r\n        }\r\n      },\r\n      orderBy: { createdAt: 'desc' }\r\n    })\r\n\r\n    return json({ visits })\r\n  } catch (error) {\r\n    console.error('GET visits error:', error)\r\n    return json({ error: 'Internal server error' }, 500)\r\n  }\r\n}\r\n\r\n// ─────────────────────────────────────────────\r\n// POST - Create a new visit record\r\n// ─────────────────────────────────────────────\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const userId = request.headers.get('x-user-id')\r\n    if (!userId) return json({ error: 'Unauthorized' }, 401)\r\n\r\n    const { patientId, visitDate, reason, symptoms, treatment, notes } =\r\n      await request.json()\r\n\r\n    if (!patientId || !visitDate || !reason)\r\n      return json({ error: 'Missing required fields' }, 400)\r\n\r\n    // Ensure patient belongs to user\r\n    const patient = await prisma.patient.findUnique({ where: { id: patientId } })\r\n    if (!patient || patient.userId !== userId)\r\n      return json({ error: 'Patient not found or unauthorized' }, 404)\r\n\r\n    const visit = await prisma.visitRecord.create({\r\n      data: {\r\n        patientId,\r\n        visitDate,\r\n        reason,\r\n        symptoms,\r\n        treatment,\r\n        notes,\r\n        userId\r\n      }\r\n    })\r\n\r\n    return json({ visit }, 201)\r\n  } catch (error) {\r\n    console.error('POST visit error:', error)\r\n    return json({ error: 'Internal server error' }, 500)\r\n  }\r\n}\r\n\r\n// ─────────────────────────────────────────────\r\n// PUT - Update a visit record\r\n// ─────────────────────────────────────────────\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    const userId = request.headers.get('x-user-id')\r\n    if (!userId) return json({ error: 'Unauthorized' }, 401)\r\n\r\n    const { id, patientId, visitDate, reason, symptoms, treatment, notes } =\r\n      await request.json()\r\n\r\n    if (!id) return json({ error: 'Visit ID required' }, 400)\r\n\r\n    const existing = await prisma.visitRecord.findUnique({ where: { id } })\r\n    if (!existing || existing.userId !== userId)\r\n      return json({ error: 'Visit not found or unauthorized' }, 404)\r\n\r\n    // Validate patient if changed\r\n    if (patientId && patientId !== existing.patientId) {\r\n      const patient = await prisma.patient.findUnique({ where: { id: patientId } })\r\n      if (!patient || patient.userId !== userId)\r\n        return json({ error: 'Patient not found or unauthorized' }, 404)\r\n    }\r\n\r\n    const updatedVisit = await prisma.visitRecord.update({\r\n      where: { id },\r\n      data: {\r\n        ...(patientId && { patientId }),\r\n        visitDate,\r\n        reason,\r\n        symptoms,\r\n        treatment,\r\n        notes\r\n      }\r\n    })\r\n\r\n    return json({ visit: updatedVisit })\r\n  } catch (error) {\r\n    console.error('PUT visit error:', error)\r\n    return json({ error: 'Internal server error' }, 500)\r\n  }\r\n}\r\n\r\n// ─────────────────────────────────────────────\r\n// DELETE - Remove a visit record\r\n// ─────────────────────────────────────────────\r\nexport async function DELETE(request: NextRequest) {\r\n  try {\r\n    const userId = request.headers.get('x-user-id')\r\n    if (!userId) return json({ error: 'Unauthorized' }, 401)\r\n\r\n    const { id } = await request.json()\r\n    if (!id) return json({ error: 'Visit ID required' }, 400)\r\n\r\n    const visit = await prisma.visitRecord.findUnique({ where: { id } })\r\n    if (!visit || visit.userId !== userId)\r\n      return json({ error: 'Visit not found or unauthorized' }, 404)\r\n\r\n    await prisma.visitRecord.delete({ where: { id } })\r\n    return json({ message: 'Visit deleted' })\r\n  } catch (error) {\r\n    console.error('DELETE visit error:', error)\r\n    return json({ error: 'Internal server error' }, 500)\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}